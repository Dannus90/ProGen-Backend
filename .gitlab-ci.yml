image: microsoft/dotnet:latest

services:
  - postgres:12.2-alpine
  - mcr.microsoft.com/dotnet/sdk:5.0
  - mcr.microsoft.com/dotnet/aspnet:5.0

variables:
  project: "ProGenBackend"
  POSTGRES_DB: progenlocal
  POSTGRES_USER: progen
  POSTGRES_PASSWORD: "progen"
  POSTGRES_HOST_AUTH_METHOD: trust

stages:
  - build
  - ci-test

before_script:
  - "dotnet restore"

build:
  stage: build
  variables:
    build_path: "$project"
  script:
    - "dotnet build"

test:
  stage: ci-test
  image: ubuntu:latest
  variables:
    test_path: "$project"
  script:
    - "dotnet test"
